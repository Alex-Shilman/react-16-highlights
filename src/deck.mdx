import { Appear, Head } from 'mdx-deck';
import { Split } from 'mdx-deck/layouts';
import { CodeSurfer } from 'mdx-deck-code-surfer';

<Head>
  <title>React 16 Highlights</title>
  {/* <meta name='twitter:card' content='summary_large_image' />
  <meta name='twitter:site' content='@jxnblk' />
  <meta name='twitter:title' content='My Presentation' />
  <meta name='twitter:description' content='A really great presentation' />
  <meta name='twitter:image' content='https://example.com/card.png' /> */}
</Head>


# React 16
<Appear>
  <img src={'https://i.pinimg.com/originals/21/6c/4e/216c4eb9707772c378fe76ba4929bf46.gif'} />
</Appear>

---
# Highlights

<Appear>
  <h3>Not everything</h3>
  <h4>Lots of resources online to learn more -- start with the React changelog and blog</h4>
</Appear>

---
## v16.0

* Fiber
* Fragments (& strings) 
* Portals
* Error Boundary

---

# What is Fiber?

<Appear>
  <h2>A new rendering engine -- that's all.</h2>
  <p>But there are some consequences.</p>
  <p>Deprecated: `componentWillReceiveOfProps`, `componentWillMount`, `componentWillUpdate`</p>
  <p>Expose new lifecycle methods: `getDerivedStateFromProps` (and `getSnapshotBeforeUpdate`)</p>
  
</Appear>

```notes
Fiber isn't a "feature" you would be using directly, it's plumbing.
It was a necessary step to _enable_ other features like lazy/Suspense and concurrent rendering.
```
---
## Why is this a problem?

<Appear>
  <p>Imagine we re-render some component with lifecycle...</p>
  <p>Let's call the first instance A and the second B</p>
  <p style={{ display: 'block', backgroundColor:'#cccccc', width: '80%', padding: '10p'}}>
    When replacing &lt;A /&gt; with &lt;B /&gt;, B.componentWillMount now always happens before A.componentWillUnmount. Previously, A.componentWillUnmount could fire first in some cases.
    <br />-- React changelog
  </p>
</Appear>

---

export default Split

<Appear>
  <h4>Before</h4>
  <ul>
    <li style={{listStyleType:'none'}}>Trigger First Render</li>
    <li style={{listStyleType:'none'}}>Mount A</li>
    <li style={{listStyleType:'none'}}>Trigger Second Render</li>
    <li style={{listStyleType:'none'}}>Unmount A</li>
    <li style={{listStyleType:'none', color: 'red'}}>Mount B</li>
  </ul>
</Appear>

<Appear>
  <h4>After</h4>
  <ul>
    <li style={{listStyleType:'none'}}>Trigger First Render</li>
    <li style={{listStyleType:'none'}} >Mount A</li>
    <li style={{listStyleType:'none'}}>Trigger Second Render</li>
    <li style={{listStyleType:'none', color: 'red'}}>Mount B</li>
    <li style={{listStyleType:'none'}}>Unmount A</li>
  </ul>
</Appear>

---

## So what?

<Appear>
  <p>I say we take a look at Table Orchestrator</p>
</Appear>

---

<CodeSurfer
  code={require("!raw-loader!./code/to-extract.js")}
  language="javascript"
  steps={[
    { lines: [1], notes: "In the constructor..." },
    { range: [4, 8], notes: "...we dispatch an init action."},
    { range: [11, 16], notes: "And then in componentWillUnmount, we (usually) delete the state" },
    { notes: "Who wants to describe the problem is?" },
  ]}
/>

---

## The fix
<Appear>
  <p>Well, workaround.</p>
</Appear>

---

<CodeSurfer
  code={require("!raw-loader!./code/to-extract-fix.js")}
  language="javascript"
  steps={[
    { lines: [5, 7], notes: "Assign a UUID to the instance..." },
    { lines: [22, 26], notes: "...and track the latest initialized instance." },
    { lines: [17], notes: "Then, when we unmount, the delete carries the instance too" },
    { range: [31, 33], notes: "and we check the id before clearing the state." },
  ]}
/>
---
# Takeaway 
<Appear>
  <img src={'https://thumbs.gfycat.com/MagnificentFoolishArcticfox-size_restricted.gif'} />
</Appear>
---

# Fragments & Strings
<Appear>
  <p>Get rid of messy wrapping elements in the DOM</p>
</Appear>
---
# Fragments

export default Split

```jsx
const FancyList = () => (
  <FancyWrapper>
    <SomeChildList />
  </FancyWrapper>
);

const SomeChildList = () => (
  <div>
    <Child key="A" />
    <Child key="B" />
    <Child key="C" />
  </div>
);
```

```jsx
const FancyList = () => (
  <FancyWrapper>
    <SomeChildList />
  </FancyWrapper>
);

const SomeChildList = () => (
  <React.Fragment>
    <Child key="A" />
    <Child key="B" />
    <Child key="C" />
  </React.Fragment>
);
```

---

 Shorthand: `<> ... </>`
<Appear>
  <p>...but we need to upgrade Babel first.
  </p>
</Appear>
 
---
# Strings

export default Split

```jsx
const HelloThere = ({name}) => (
  <span>
    {`Hello, ${name}!`}
  </span>
);
```

```jsx
const HelloThere = ({name}) => (
  `Hello, ${name}!`
);
```
---

# Portals
<Appear>
  <p>Render somewhere else.</p>
</Appear>

---

```jsx
render() {
  // ...
  return (
    <div>
      {this.props.children}
    </div>
  );
}
```
---

```jsx
render() {
  // ...
  return ReactDOM.createPortal(
    this.props.children,
    domNode
  );
}
```
---
```jsx

const Notifications = ({ messages }) =>
  ReactDOM.createPortal(
    messages.map(m => <Notification text={m}/>),
    document.getElementById('notify-area');
  );
}
...
// in some input component
render() {
  <React.Fragment>
    <InputVisualization />
    <Notifications message={this.errorMessages} />
  </React.Fragment>
}
```
---

# Error Boundary
<Appear>
  <p>Allows components to catch errors</p>
  <p>Expose new lifecycle methods: `componentDidCatch` and `getDerivedStateFromError`</p>
</Appear>

```notes
getDerivedStateFromError parallels getDerivedStateFromProps -- return a state update object.
```

---

<CodeSurfer
  code={require("!raw-loader!./code/error-boundary.js")}
  language="javascript"
  steps={[
    { lines: [4], notes: "We start without an error" },
    { range: [7, 10], notes: "if we need to update our component state." },
    { range: [12, 15], notes: "we can also manage other externalities here." },
    { range: [17, 21], notes: "We consume the stateful value now in the render." },
  ]}
/>
---

## v16.1 & 16.2

<Appear>
  <h3><i>Mostly fixes and optimizations</i></h3>
  <iframe
    seamless="seamless"
    style={{
      width: '80%',
      border: 'none',
      maxWidth: '500px',
      display: 'block',
    }}
    src="https://getyarn.io/yarn-clip/embed/e773e6ae-790a-4c10-918b-1d941cb9dee0?autoplay=false">
  </iframe>
</Appear>
---

https://thumbs.gfycat.com/MagnificentFoolishArcticfox-size_restricted.gif

---
## v16.3 
  * Context
  * getDerivedStateFromProps
  * Strict Mode
  * Packages: Lifecycle Compat, Subscriptions, ReactIs

---

## v16.4 & 16.5: 
  * Profiler

---

## v16.6
  * lazy & Suspense
  * memo  

---

# We Can See The Future!

* 16.7 (alpha)
  * Concurrent (n√©e _async_) rendering
  * Hooks
* ...and beyond
  * Scheduler
  * Cache


---
```jsx
<CodeSnippet />
```
---
import Demo from './components/Demo'

<Demo />
---
# The end